name: S23 FE Port Universal7885

on:  
  workflow_dispatch:  # Permette di eseguire manualmente il workflow

jobs:
  build_s23fe_port:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Scarica Firmware
      run: |
        # Usando curl per scaricare il firmware da una URL
        curl -L https://download1527.mediafire.com/bu719hbfd4ig6euBZ_xwXxMmhSmLOX9zB-NN9id3YlKsNDjCWlY_n96T-rXZ5niePZrbbFaRe1WiSmho_4UCJJb999j4IPLM2IePUGX2gVxDGBwbfJwArkQ8_JXUFw3sm_iVjouBv2px2Syz6Zf2gKVHPVkF1SU3oeS5MafcJPskOA/jw2btnw1w8n45x2/S23FE_Port.zip -o s23fe/ROM/system.zip

    - name: Estrai Firmware.zip
      run: |
        # Estrai il firmware se Ã¨ in formato zip
        unzip s23fe/ROM/system.zip -d s23fe/ROM/ && rm -rf s23fe/ROM/system.zip

    - name: Debloat
      run: |
        # Esegui il debloat
        chmod +x script/system/s23fe_debloat.sh && ./script/system/s23fe_debloat.sh

    - name: Common
      run: |
        # Copia i file comuni nella rom
        chmod +x script/system/s23fe_common.sh && ./script/system/s23fe_common.sh

    - name: Fix
      run: |
        # Esegui i fix
        chmod +x script/system/s23fe_fix.sh && ./script/system/s23fe_fix.sh

    - name: Comprimi ROM
      run: |
        # Comprimi la rom
        cd s23fe/ROM
        zip -r -9 -FS s23fe_Port.zip device META-INF product system vendor RAMDisk.img && rm -rf s23fe/ROM/system

    - name: Setup SSH key
      run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SF_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan frs.sourceforge.net >> ~/.ssh/known_hosts

    - name: Upload firmware files to SourceForge
      run: |
          scp s23fe/ROM/s23fe_Port.zip thewinner02@frs.sourceforge.net:/home/frs/project/oneui-ports/test/ && rm -rf s23fe_Port.zip
          
