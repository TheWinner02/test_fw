name: Download e Estrai Firmware Samsung

on:  
  workflow_dispatch:  # Permette di eseguire manualmente il workflow

jobs:
  download_firmware:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Scarica Firmware
      run: |
        # Usando curl per scaricare il firmware da una URL
        curl -L https://dl.samfwpremium.cloud/56a5fd341569713b8aca5cfa866d2d36lp1dj77gSRbOrBg52RDY--KHcQ05lVTZHg9lJBnF5zLRKRY-qsPFX65tYuYlU00vCOumH8e58OvKw4xxsHNCXJPnMNN_q_tZ0bYUVz4oMZQ4Hc-3oT8HYxJEQYP1pIPkWuQPJDNN9GPty0BVpuJko7DvzeY30RYCvZ4N92gtf6tm_VN534i30l0_PjcTgVrg24Wz6eRfCFqIrnZafuPcP4wX7PiElEyT2tVwtWi4geUZVHolyly6HF7P_JZHZHmLwjDMoFAP697kfML7EB24Lq69NaNsXe4EEu54Wsoohs2_mVLjN9hBNMZFFgYpXJK8VOwaBgZLDqXFmJ6pJFnZB0SFTK7PgaepQgBJHqs5Kr_a4_MhhYP_suB12KIITxDqzesId9E9McSOB_itFO1tEn-VMJ5UIbyU43b9S8nEkvxfZa7uG34_inR7pqnVHQ-vi9INqu__OGbmWyce115-0ZZPeLy7KxDbjUOWlu7CGDzAEJZb0S5vzT_IJWgK-o7Md8qGKHPrfzpBoikkDjimAFKD8paZAU1YGRS2h3IFhFDWoSFULCZ6OM6NP-7LxGeOtr-7gtsWlkX9qoYjjEUlZN6gcvOHEODGraFjVlGSHLsjTkzxaAQ-mPYa8QjMw3njvhREqC8pyATidbKMrOKWUnBCty5EOxTJ8iIpFVGCHQkVnSlH6OzJGNtEiZCqrIZZqRZ9R-uoLMfG8aEOHOpNAnJbo2K3vZMEkpDkA_Q6BPafGVu5A-ZEMsH4hm3O3sdW8q7CFGd4nc8_0O50twZq6iXM7wCwCP5s3g9p6P01PPZR10kjMBPuUgrO3O2MWrlg1BrPckZuocMShy5Sle4W_TeJMG_5LzCjCkjc7_EubUESHht6j0_0ADEeXI3zlZnG8QJGtZTnQm4nuNJluVOD8aSfhO-HincXUoMZTfiUiZCY1Jfg_S291Mf0GMMpYnc46AiwvGsH6Q9TMdXiWRHVU1S16J0U1mzXgWHOPCMz_1jAOaMuiitDpXxpCsoD7zlS3xTx3SAOg8gLvCUXoMrQhSLYA99TnqXvhscm4nyRqrnPp9od2G54uRmoBvwhIkSVuRl4JLr9_AqWy0ogaoBnTA?file_name=SAMFW.COM_SM-A536B_EUX_A536BXXSDEYB1_fac.zip -o firmware.zip

    - name: Estrai Firmware.zip
      run: |
        # Estrai il firmware se è in formato zip
        unzip firmware.zip -d firmware && rm -rf firmware.zip
        rm -rf firmware/BL*.tar.md5 && rm -rf firmware/CP*.tar.md5 && rm -rf firmware/HOME*.tar.md5 && rm -rf firmware/*.txt

    - name: Estrai md5
      run: |
        # Estrai il firmware se è in formato md5
        tar -xf firmware/AP*.tar.md5 super.img.lz4 && rm -rf firmware/AP*.tar.md5
        tar -xf firmware/CSC*.tar.md5 optics.img.lz4 && tar -xf firmware/CSC*.tar.md5 prism.img.lz4
        rm -rf firmware

    - name: Estrai lz4
      run: |
        # Estrai il firmware se è in formato lz4
        lz4 -d -q --rm super.img.lz4 super.img.sparse && lz4 -d -q --rm optics.img.lz4 optics.img.sparse && lz4 -d -q --rm prism.img.lz4 prism.img.sparse

    - name: Installa simg2img
      run: |
        # Installa simg2img
        sudo apt-get update && sudo apt-get install android-sdk-libsparse-utils

    - name: Converti Sparse in Raw
      run: |
        # Converti sparse in raw
        simg2img super.img.sparse super.img && rm -rf super.img.sparse
        simg2img optics.img.sparse optics.img && rm -rf optics.img.sparse
        simg2img prism.img.sparse prism.img && rm -rf prism.img.sparse
        
    - name: Comprimi Firmware
      run: |
        # Comprimi il firmware
        zip -r -9 -FS -m firmware.zip super.img optics.img prism.img

    - name: Setup SSH key
      run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SF_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan frs.sourceforge.net >> ~/.ssh/known_hosts

    - name: Upload firmware files to SourceForge
      run: |
          scp firmware.zip thewinner02@frs.sourceforge.net:/home/frs/project/oneui-ports/test/
          
