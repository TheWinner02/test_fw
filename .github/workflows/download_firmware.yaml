name: Download e Estrai Firmware Samsung

on:  
  workflow_dispatch:  # Permette di eseguire manualmente il workflow

jobs:
  download_firmware:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Scarica Firmware
      run: |
        # Usando curl per scaricare il firmware da una URL
        curl -L https://dl.samfwpremium.cloud/5665ccf4102c4ccddf4ce5416d6f58afSq8I-uwroU2RLOw1F0-eWyn8VKaskF1WAMsQRYrFo8yZXIJFA9QRqQ16TKXTaN9oTRAzV2c0tAhvUPl9etik_Z4kPW4-GgSxUTOGiFXXmyPn4jhC5OHJ6sY9S6OqXs0lOy5QTvKeDQMGdFPO_RnmdVNuObl7gNuBON6-oQBbak7YQIndJ6bfOne_RIsT3rkCBaJMlokvViK_XQwPrm0SsMWhHsHH-e031J1DEuWplp-6hymRTkugLDX_yFMDmwVNHKwmzd4kK1342AhIqzPdPRNfL6sVmII-xJeFLr1NhjqkzjG-OGroDvjU6e7lSDfY-Lh1f27_X32IUMRTbfBqK_SJNyFLriOhLGDgrCsVcazlS8XcyYOTFTI8BPYz0QCUICcxOoMQQb2D73ayK49AUa7oMlffDzhJ0GT4NDG0Flrr9t72OLDznYnJiCETJoNCiund4ZSi5txlXvZIVLZn9k9pEqb_bYjRboaCFIWgStBM_qpAaGjI8fvQjInimh2TX0pRQwZCoKKXhsHLnrh4EATPoIHb24spQ6Xz4T7XQi_ho0ba9Hz0odTtCmTplbzdPIgP55oKWoFhB_je_M8RF8Kkot-BQfj4UpAXZgqueD0WWxEHJu79gMnjGTHVAAFrdRvlG7EcN4FkGmylksznR-1WVfNxxB24On2aWsxT36dxaRv9nTXNomQR7dQh4wC1dWryIQCgXnPqGLgRW4OCny2O5ulbzvHxxg_5CHJGW9XIiVowPazNBO92MwpY_s9UJFbB1xpHeMJFBs1tK62o1rWg-s8zyHZyBD_E-GlVl99C6vGqFHpUCZdGR-hw2yXwCieUnTA3yYKzU0RNQa7Lh4F3eP6gRAuDgDwcR6xDoOIheUX0mGLC_jatbXo_pqhJSu4uN-zTJYyPZC3f0l3TPwrOVwhfAlOMUxx80ZzUEmP250-_x4slBQzf0WHbuHvNIzx_LKcjNuuL03GtyKdrNaBa-9eDh7EgcSy0HQWNhe2pEFrT-_fqB-2R19wQxrpb8tP2nMkAiQCM1ndS5zdHJ6BeF98nc_FDdTNZnBfwiQd-zBbPLwLqVnNGtE_brPSWyk6UQe-XAeGV_rq1hzxDmg?file_name=AP_S911BXXS8CYBD_S911BXXS8CYBD_MQB93024377_REV00_user_low_ship_MULTI_CERT_meta_OS14.tar.md5.zip -o firmware.zip

    - name: Estrai Firmware.zip
      run: |
        # Estrai il firmware se è in formato zip
        unzip firmware.zip -d firmware && rm -rf firmware.zip

    - name: Estrai md5
      run: |
        # Estrai il firmware se è in formato md5
        tar -xf firmware/AP*.tar.md5 super.img.lz4 && rm -rf firmware/AP*.tar.md5
        rm -rf firmware

    - name: Estrai lz4
      run: |
        # Estrai il firmware se è in formato lz4
        lz4 -d -q --rm super.img.lz4 super.img.sparse

    - name: Installa simg2img
      run: |
        # Installa simg2img
        sudo apt-get update && sudo apt-get install android-sdk-libsparse-utils

    - name: Converti Sparse in Raw
      run: |
        # Converti sparse in raw
        simg2img super.img.sparse super.img && rm -rf super.img.sparse
        
    - name: Comprimi Firmware
      run: |
        # Comprimi il firmware
        zip -r -9 -FS -m firmware.zip super.img

    - name: Setup SSH key
      run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SF_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan frs.sourceforge.net >> ~/.ssh/known_hosts

    - name: Upload firmware files to SourceForge
      run: |
          scp firmware.zip thewinner02@frs.sourceforge.net:/home/frs/project/oneui-ports/test/
          
