name: Download e Estrai Firmware Samsung

on:  
  workflow_dispatch:  # Permette di eseguire manualmente il workflow

jobs:
  download_firmware:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Scarica Firmware
      run: |
        # Usando curl per scaricare il firmware da una URL
        rm -rf a53 common edits fix s21 s23fe script && curl -L https://dl.samfwpremium.cloud/c06b5fbd2d4e01feb4f7874bf44a081cmx_rPzLUEw0n-o_4LGyXMwoaLV2FZoYhq5hMe8kfi36IJLkuca2LSS0FQ2etWvN2PyN54Lm1r1C4R2oFKvPqAm5V8xQaXB7dWOrbkEQXrwMBB3DbsME2BFfgj462SSXIJ2q_yL9EN778FJMZA3MIiX-45NDnJYoncNkldnF9x-3hN1BPi5Acz4vDPXDhVtrLWlbnfWCvbypNgsvXF4K9mOg_d8JKh7MjWl8fyml9g5dEXJM3eDetukcTbQmwGwOcBEXkMkQhIMJQFQRw4J7Bq6LA5qUOL97pUE3e-yE03QESvKyV2-HYwBm7VCpZr3ba28cRU5_ZVCWg87sh6HSfRGNRwsnarQi1wTSRVJCAcw5oU7bpowDFVvzIccaAbYzP-dygiDywOpV7UjDB8k_7rVsRF4zACSHBct0QRp6zOvXUiSy0MaqloXvXUH14mBfCqZk_0aZR3rd1llqycJCkaK0a8lp-05Y_OzV2wW1wSQKRkF6_xeckW8eJrY_bamUPDB95aeGTxgzNiyhIkl3YbdZAh1zwRuUK3UkeOF4TL4zW_FdM3dJd9pR_QSNZLSltDdqUm0m4NxZQnQzAZ3u9AZnHoqpBoPCoDUuSaF3lu9G-cMqglGite_1U48JUlwsJlDQRMVmMZy63R-TcNBKfmsA1bPrYT3AQnurNXlv-JiAjQ86XPhQOtzlac-Y8u1XXEhQOcnwY6Q22NCNa92Lm-TEqU6Vq91ExYp8z8oMitvszvdud0YJxWueCafvdF7gjaOlyfbmy171hOsukXaFijHhBUgd_Bu-OdRP1Nsq9LnnPw0D8B5M5N2OzNPEpBvL4s9g2m5pxFL0Nj5dJXMqXNbn6Sl0E6o2_RexL21MRoX4HKbdBQ68ZLBNLNhEHewORCHbTBogEsM6316LQJ4_C2snxZPFNzKm0fO-n54wYKM-DW1XPMogPoZNBpApbrsXFMWRquJgYEY0soa_SjzjPj38qqG27h0ly1amxTCv20DuBd5H4I-HAnMrceLCoS7LuUd2zWF2pbn8_brnb34C9qmOc-pMjCj5LBJt8bFTQQJwKM1t7TOoD2g786XLxiu0L5L0woh2Wo8w4_ULbxETCpQ?file_name=AP_S911BXXS8CYBD_S911BXXS8CYBD_MQB93024377_REV00_user_low_ship_MULTI_CERT_meta_OS14.tar.md5.zip -o firmware.zip

    - name: Estrai Firmware.zip
      run: |
        # Estrai il firmware se è in formato zip
        unzip firmware.zip -d firmware && rm -rf firmware.zip

    - name: Estrai md5
      run: |
        # Estrai il firmware se è in formato md5
        tar -xf firmware/AP*.tar.md5 super.img.lz4 && rm -rf firmware/AP*.tar.md5
        rm -rf firmware

    - name: Estrai lz4
      run: |
        # Estrai il firmware se è in formato lz4
        lz4 -d -q --rm super.img.lz4 super.img.sparse

    - name: Installa simg2img
      run: |
        # Installa simg2img
        sudo apt-get update && sudo apt-get install android-sdk-libsparse-utils

    - name: Converti Sparse in Raw
      run: |
        # Converti sparse in raw
        simg2img super.img.sparse super.img && rm -rf super.img.sparse
        
    - name: Comprimi Firmware
      run: |
        # Comprimi il firmware
        zip -r -9 -FS -m firmware.zip super.img

    - name: Setup SSH key
      run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SF_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan frs.sourceforge.net >> ~/.ssh/known_hosts

    - name: Upload firmware files to SourceForge
      run: |
          scp firmware.zip thewinner02@frs.sourceforge.net:/home/frs/project/oneui-ports/test/
          
